<!doctype html>

<head>
    <title>L1 Game</title>
</head>

<body>

    <canvas id="gameCanvas" width="600" height="600"> //vars for canvas

    </canvas>

    <script>
        var canvas, canvasContext; //vars for canvas

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d'); //defines canvas vars
            document.addEventListener('keydown', keyPressed); //event listeners for pressing keys
            document.addEventListener('keyup', keyReleased); //event listeners for releasing keys
            setInterval(mainloop, 1000 / 60); //runs mainloop 60 times per second


            username = prompt('Enter username') //asks username
            while (username == null || username == "") { //this is to ask the username repeatedly until the user enters a valid username - not pressing cancel or entering nothing
                username = prompt('Enter username') //asks username again if user enters nothing
            }

            level = prompt('Hello ' + username + '! Choose a level: Easy, Medium or Hard?', 'easy') //asks level
            level = level.toLowerCase() //converts level input to lowercase


            while (level != 'easy' && level != 'medium' && level != 'hard') { //this is to ask the level repeatedly until the user enters a valid level
                level = prompt('Please choose a valid level: Easy, Medium or Hard?') //asks level until user enters valid level

            }




            alert('Use arrow keys to move. Avoid and shoot as many red asteroids as you can, and collect as many blue comets as you can. The longer you stay alive, the higher you score will be. You have 3 lives and ' + totalBullets + ' bullets. The game will start as soon as you press OK.') //alerts game intructions



            gameStart = true; //sets gameStart to true (so mainloop will run)



            if (level == 'easy') { //changes number of bullets if level is easy
                totalBullets = 40
            } else if (level == 'medium') { //changes number of bullets and enemies if level is medium
                totalBullets = 35
                totalEnemies = 8

            } else if (level == 'hard') { //changes number of bullets and enemies and high and low speeds for comets if level is hard
                totalBullets = 30
                totalEnemies = 10;
                cometHighSpeed = 14;
                cometLowSpeed = 6;
            } //changes number of enemies on screen, total number of bullets and speed of enemies based on difficulty level

        } //end of window.load = function()



        //images for player, enemy and comet
        var player = new Image();
        player.src = 'images/player.png'
        var enemyImg = new Image();
        enemyImg.src = 'images/enemy.png'
        var cometImg = new Image();
        cometImg.src = 'images/comets.png'

        //vars for player
        const PLAYER_SIZE = 70;
        var playerXpos = 300 - (PLAYER_SIZE / 2);
        var playerYpos = 600 - PLAYER_SIZE;
        var playerXspeed = 5;
        var playerYspeed = 4;

        //var for enemies
        const ENEMY_WIDTH = 25;
        const ENEMY_HEIGHT = 60;
        var enemyXpos = 0;
        var enemyYpos = 0;
        var enemyYspeed = 4;

        //vars for comets
        const COMET_WIDTH = 30
        const COMET_HEIGHT = 40
        var cometXpos = 0;
        var cometYpos = 0;
        var cometXspeed = 5;
        var cometYspeed = 4;

        //vars for bullets
        const BULLET_SIZE = 30
        var bulletXpos = 0;
        var bulleYpos = 0;
        var bulleYspeed = 4;

        //vars for directional keys
        var leftKeyPress = false;
        var rightKeyPress = false;
        var upKeyPress = false;
        var downKeyPress = false;
        var spaceKeyPress = false;

        //consts for key codes
        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;
        const SPACE_KEY = 32;

        //high and low speeds for enemy and comet
        var enemyHighSpeed = 10;
        var enemyLowSpeed = 6;
        var cometHighYspeed = 8;
        var cometLowYspeed = 4;
        var cometHighXspeed = 6;
        var cometLowXspeed = 2;

        //arrays
        var enemies = [];
        var bullets = [];
        var comets = [];

        //vars for making objects
        var makingEnemies = true;
        var makingBullets = true;
        var makingComets = true;

        //totals for objects
        var totalEnemies = 5;
        var totalBullets = 5;
        var totalComets = 1;

        //counting bullets
        var bulletCount = 0;
        var remainingBullets = 5;

        //score and lives
        var lives = 3;
        var lifeCount = 3;
        var playerScore = 0;

        //var to run game (controls mainloop)
        var gameStart = false;

        //var for username and lives
        var username = ""
        var level = ""

        //vars for score/life/bullet increments/decrements
        var playerHitEnemyScore = 4;
        var playerHitCometScore = 2;
        var playerHitCometBullets = 3;
        var bulletHitEnemyScore = 3;


        setInterval(function() { //func to increase score by 1 every half a second
            if (lives > 0) {
                playerScore++
            }
        }, 500) //end setInterval func


        function makeComet() { //creates a single comet object with vars and pushes it into comets array
            var cometPos = Math.floor(Math.random() * 4) + 1;
            var cometXpos = cometPos * (canvas.width / 4)
            const COMET_WIDTH = 30
            const COMET_HEIGHT = 40
            var cometYpos = 0 - COMET_HEIGHT
            var cometXspeed = Math.floor(Math.random() * (cometHighXspeed - cometLowXspeed) - cometLowXspeed);
            var cometYspeed = Math.floor(Math.random() * (cometHighYspeed - cometLowYspeed) + cometLowYspeed);
            //sets comet variables

            var comet = { //defines comet object properties
                cometXpos: cometXpos,
                cometYpos: cometYpos,
                cometXspeed: cometXspeed,
                cometYspeed: cometYspeed,
                COMET_WIDTH: COMET_WIDTH,
                COMET_HEIGHT: COMET_HEIGHT
            }

            comets.push(comet); //pushes comet object into comets array
        } //end makeComet func


        function makeEnemies() { //creates a single enemy object with vars and pushes it into enemies array
            var enemyPos = Math.floor(Math.random() * 4) + 1;
            var enemyXpos = enemyXpos * (canvas.width / 4);
            const ENEMY_WIDTH = 25;
            const ENEMY_HEIGHT = 65;
            var enemyYpos = 0 - ENEMY_HEIGHT;
            var enemyYspeed = Math.floor(Math.random() * (enemyHighSpeed - enemyLowSpeed) + enemyLowSpeed);
            //sets enemy vars

            var enemy = { //defines enemy object properties
                enemyXpos: enemyXpos,
                enemyYpos: enemyYpos,
                enemyYspeed: enemyYspeed,
                ENEMY_WIDTH: ENEMY_WIDTH,
                ENEMY_HEIGHT: ENEMY_HEIGHT
            }

            enemies.push(enemy); //pushes comet object into comets array
        } //end makeEnemies func

        function makeBullet() { //creates a bullet object with vars and pushes it into bullets array
            const BULLET_SIZE = 5;
            var bulletXpos = playerXpos + (PLAYER_SIZE / 2) - BULLET_SIZE / 2;
            var bulletYpos = playerYpos; //bullet would start at the same position as the player so it would be seen as the player shooting bullets
            var bulletYspeed = 10;
            //sets up bullet vars

            var bullet = { //defines bullet object properties
                bulletXpos: bulletXpos,
                bulletYpos: bulletYpos,
                bulletYspeed: bulletYspeed,
                BULLET_SIZE: BULLET_SIZE

            }

            bullets.push(bullet); //pushes comet object into comets array
        } //end makeBullet func


        function bulletsRemaining() { //calculates the number of bullets the player has left
            if (bulletCount <= totalBullets) { //if there the number of spent bullets is less than available bullets, then show how many are remaining

                remainingBullets = (totalBullets - bulletCount);
            } else {
                remainingBullets = 0 //if all available bullets are spent, then show remaining bullets as 0
            }

        } //end bulletsRemaining func


        function start() { //sets gameStart to false if player has no lives are left
            if (lives <= 0) {
                gameStart = false;
            }
        } //end start func

        function mainloop() { //basically runs the game



            colorRect(0, 0, canvas.width, canvas.height, 'black'); // draws background

            if (gameStart) { //if user has lives left

                drawImg(player, playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE); // draws player
                canvasContext.font = '16pt Calibri';
                canvasContext.fillStyle = 'blue';

                canvasContext.fillText('Score: ' + playerScore, canvas.width * 0.02, 40);
                canvasContext.fillText('Lives: ' + lives, canvas.width - canvas.width * 0.15, 40);
                canvasContext.fillText('Bullets: ' + parseInt(remainingBullets), (canvas.width * 0.9) / 2, 40);
                //shows the score, lives and remaining bullets


                start(); //sees whether user has lives left

                playerMove();
                enemyMove();
                cometMove();
                //moves player, enemies, comets

                if (makingEnemies == true) { //starts making enemy object when game starts
                    for (i = 0; i < totalEnemies; i++) { //loops through the enemies array and makes enemy objects as long as the enemy numbers doesn't go above the total enemies for that level
                        makeEnemies();
                    }
                    makingEnemies = false;
                }
                drawEnemy();
                //makes and draws enemies by looping through the array


                if (bulletCount <= totalBullets) { //if there are bullets available
                    bulletMove(); //moves bullet
                    if (makingBullets == true) { //starts making bullet object when game starts
                        for (i = 0; i < totalBullets; i++) { //loops through the enemies array and makes enemy objects as long as the enemy numbers doesn't go above the total enemies for that level
                            makeBullet();
                        }
                        makingBullets = false;

                    }
                    drawBullet();
                }
                //makes and draws bullets by looping through the array


                if (makingComets == true) { //starts making comet object when game starts

                    for (i = 0; i < totalComets; i++) { //loops through the enemies array and makes enemy objects as long as the enemy numbers doesn't go above the total enemies for that level
                        makeComet();
                    }
                    makingComets = false;
                }
                drawComet();
                //makes and draws bullets by looping through the array

                bulletsRemaining(); //calculates remaining bullets
            } else { //if user has no lives left




                highScore(); //calculate highscore
                canvasContext.font = '32pt Calibri'; //sets font
                canvasContext.fillStyle = 'blue'; //sets font colour
                canvasContext.shadowBlur = 2; //sets shadow properties
                canvasContext.shadowColor = 'white'


                canvasContext.fillText('Game Over', canvas.width * 0.35, canvas.height * 0.45); //informs the user that they have lost
                canvasContext.fillText(username + ', Your score is ' + playerScore, (canvas.width - username.length) * 0.25, canvas.height * 0.55); //displays current score
                canvasContext.fillText('Your high score is ' + localStorage.getItem('highscore'), canvas.width * 0.24, canvas.height * 0.65); //display highscore
                //display 'game over' and score

                if (lifeCount <= 0) { //if no lives are left

                    lifeCount = 1; //make lives = 1 so this doesn't loop through indefinitely
                    setTimeout(function() { //asks the player whether they want to play again after 1.5 seconds
                        var playAgain = confirm("Play again?")//var for storing user preference for playing again
                            if(playAgain == true){
                        location.reload();//page will reload if they say they want to play again. nothing will happen if they press cancel.
                              }
                                    
                    }, 1000); //end of setTimeout function()
                } 
            }


        } //end of mainloop func



        function highScore() { //calculates highscore
            var highscore = localStorage.getItem('highscore') //retrieves stored high score
            if (playerScore > highscore) { //if current score is higher thanm stored highscore, then store current score as new highscore
                localStorage.setItem('highscore', playerScore)
            }
        }


        function drawEnemy() { //draws enemy with enemy properties
            enemies.forEach(function(enemy, i) { //loops through the enemies loop and applies to every enemy object
                drawImg(enemyImg, enemy.enemyXpos, enemy.enemyYpos, enemy.ENEMY_WIDTH, enemy.ENEMY_HEIGHT) //draws enemy with the relevant properties
            }) //end enemies.forEach func
        } //end drawEnemy func

        function drawComet() { //draws enemy with enemy properties
            comets.forEach(function(comet, i) { //loops through the comets loop and applies to every comet object
                drawImg(cometImg, comet.cometXpos, comet.cometYpos, comet.COMET_WIDTH, comet.COMET_HEIGHT) //draws comet with the relevant properties
            }) //end comets.forEach func
        } //end drawComet func

        function drawBullet() { //draws enemy with enemy properties
            bullets.forEach(function(bullet, i) { //loops through the bullets loop and applies to every bullet object
                colorRect(bullet.bulletXpos, bullet.bulletYpos, bullet.BULLET_SIZE, bullet.BULLET_SIZE, 'white'); //draws bullet with the relevant properties

            }) //end bullets.forEach func
        } //end drawBullet func

        function colorRect(x, y, w, h, c) { //sets syntax for colorRect (drawing rectangles)
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        } //end colorRect func


        function drawImg(src, x, y, w, h) { //sets syntax for drawImg (drawing using images)
            canvasContext.drawImage(src, x, y, w, h);
        } //end drawImg func

        function keyPressed(evt) { //registers when a directional key is pressed
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPress = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPress = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPress = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPress = true;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPress = true;
                makeBullet();
                bulletCount++ //makes bullet and increases bulletCount by 1 if space key is pressed
            }
        } //end keyPressed(evt) func

        function keyReleased(evt) { //registers when a directional key is released
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPress = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPress = false;
            }
            if (evt.keyCode == UP_KEY) {    
                upKeyPress = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPress = false;
            }
        } //end keyReleased(evt) func



        function playerMove() { //moves player up, down, left or right based on the directional key pressed, and doesn't let player get out of the screen
            if (leftKeyPress == true && playerXpos > 0) { //move left if left key is pressed and player doesn't go out of the canvas
                playerXpos -= playerXspeed;
            };
            if (rightKeyPress == true && playerXpos < canvas.width - PLAYER_SIZE) { //move right if right key is pressed and player doesn't go out of the canvas
                playerXpos += playerXspeed;
            };
            if (upKeyPress == true && playerYpos > 0) { //move up if up key is pressed and player doesn't go out of the canvas
                playerYpos -= playerYspeed;
            };
            if (downKeyPress == true && playerYpos < canvas.height - PLAYER_SIZE) { //move down if down key is pressed and player doesn't go out of the canvas
                playerYpos += playerYspeed;
            };
        } //end playMove func


        function cometMove() { //func for moving comets
            comets.forEach(function(comet, i, array) { //loops through the comets array and applies to every comet object

                comet.cometXpos += comet.cometXspeed;
                comet.cometYpos += comet.cometYspeed; //moving diagonally with both x and y pos increasing at the same time
                if (comet.cometXpos + comet.COMET_WIDTH > canvas.width) { // right edge bouce
                    comet.cometXspeed = comet.cometXspeed * -1; //randomises moving direction
                }
                if (comet.cometXpos < 0) { // left edge bouce
                    comet.cometXspeed = comet.cometXspeed * -1; //randomises moving direction
                }

                if (comet.cometYpos > canvas.height) { //if comet goes out of the canvas
                    comet.cometYpos = 0 - comet.COMET_HEIGHT;
                    comet.cometXpos = Math.floor(Math.random() * (canvas.width - comet.COMET_WIDTH));
                    comet.cometYspeed = Math.floor(Math.random() * (cometHighYspeed - cometLowYspeed) + cometLowYspeed)
                    comet.cometXspeed = Math.floor(Math.random() * (cometHighXspeed - cometLowXspeed) + cometLowXspeed)
                } //back to top of canvas with random x pos, y and x speed if comet goes out of canvas


                if (playerYpos <= comet.cometYpos + comet.COMET_HEIGHT && playerYpos + PLAYER_SIZE >= comet.cometYpos && playerXpos <= comet.cometXpos + comet.COMET_WIDTH && playerXpos + PLAYER_SIZE >= comet.cometXpos) //if comet touching/overlapping player
                {

                    comet.cometYpos = 0 - comet.COMET_HEIGHT;
                    comet.cometXpos = Math.floor(Math.random() * (canvas.width - comet.COMET_WIDTH));
                    comet.cometYspeed = Math.floor(Math.random() * (cometHighYspeed - cometLowYspeed) + cometLowYspeed)
                    comet.cometXspeed = Math.floor(Math.random() * (cometHighXspeed - cometLowXspeed) + cometLowXspeed)
                    //back to top of canvas with random x pos, y and x speed if comet overlaps player
                    playerScore = playerScore + playerHitCometScore;
                    totalBullets = totalBullets + playerHitCometBullets; //increase score by 2 and bullets by 3 if comet hits player
                }

            }) //end comets.forEach func
        } //end cometMove func

        function enemyMove() { //func for moving enemies
            enemies.forEach(function(enemy, i, array) { //loops through the enemies array and applies to every enemy object
                enemy.enemyYpos += enemy.enemyYspeed; //moves bullet vertically downwards
                if (enemy.enemyYpos > canvas.height) { //if enemy goes out of canvas
                    enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                    enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                    enemy.enemyYspeed = Math.floor(Math.random() * (enemyHighSpeed - enemyHighSpeed) + enemyLowSpeed);
                }
                //back to top of canvas with random x pos, y and x speed if enemy goes out of canvas

                if (playerYpos <= enemy.enemyYpos + enemy.ENEMY_HEIGHT && playerYpos + PLAYER_SIZE >= enemy.enemyYpos && playerXpos <= enemy.enemyXpos + enemy.ENEMY_WIDTH && playerXpos + PLAYER_SIZE >= enemy.enemyXpos) //if enemy touching/overlapping player
                {
                    enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                    enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                    enemy.enemyYspeed = Math.floor(Math.random() * (enemyHighSpeed - enemyLowSpeed) + enemyLowSpeed);
                    //back to top of canvas with random x pos, y and x speed if enemy overlaps player

                    if (lives > 0) { //if lives are left
                        lives--
                        lifeCount--
                        playerScore = playerScore - playerHitEnemyScore
                        //reduce lives by 1 and score by 4 if player hits enemy

                    }
                }
            }) //end enemies.forEach func
        } //end enemyMove func




        function bulletMove() { //func for moving bullets
            bullets.forEach(function(bullet, i, array) { //loops through the bullets array and applies to every bullet object
                bullet.bulletYpos -= bullet.bulletYspeed //moves bullet vertically upwards
                if (bullet.bulletYpos < 0) { //if bullets go out of canvas
                    delete bullets[i]
                } //delete bullet if goes out of canvas

                enemies.forEach(function(enemy, i, array) { //loops through the enemies array and applies to every enemy object

                    if (bullet.bulletYpos <= enemy.enemyYpos + enemy.ENEMY_HEIGHT && bullet.bulletYpos + bullet.BULLET_SIZE <= enemy.enemyYpos && bullet.bulletXpos <= enemy.enemyXpos + enemy.ENEMY_WIDTH && bullet.bulletXpos + bullet.BULLET_SIZE >= enemy.enemyXpos) //if bullet touching/overlapping enemy
                    {
                        enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                        enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                        enemy.enemyYspeed = Math.floor(Math.random() * (enemyHighSpeed - enemyLowSpeed) + enemyLowSpeed);
                        //enemy goes to top of canvas with random x pos and y speed if enemy hits bullet

                        bullet.bulletYpos = -1; //moves bullet out of the screen. this will then be deleted because it is out of the screen.




                        playerScore = playerScore + bulletHitEnemyScore //increase score by 3
                    }
                }) //end enemies.forEach func

                comets.forEach(function(comet, i, array) { //loops through the comets array and applies to every comet object

                    if (bullet.bulletYpos <= comet.cometYpos + comet.COMET_HEIGHT && bullet.bulletYpos + bullet.BULLET_SIZE <= comet.cometYpos && bullet.bulletXpos <= comet.cometXpos + comet.COMET_WIDTH && bullet.bulletXpos + bullet.BULLET_SIZE >= comet.cometXpos) //if bullet touching/overlapping comet
                    {
                        comet.cometYpos = 0 - comet.COMET_HEIGHT;
                        comet.cometXpos = Math.floor(Math.random() * (canvas.width - comet.COMET_WIDTH));
                        comet.cometYspeed = Math.floor(Math.random() * (cometHighYspeed - cometLowYspeed) + cometLowYspeed)
                        comet.cometXspeed = Math.floor(Math.random() * (cometHighXspeed - cometLowXspeed) + cometLowXspeed)
                        //comet goes to top of canvas with random x pos and x and y speed if enemy hits bullet

                        bullet.bulletYpos = -1; //moves bullet out of the screen. this will then be deleted because it is out of the screen.

                    }
                }) //end comets.forEach func

                enemies = enemies.filter(item => item !== undefined); //remove undefined - out of screen or shot by bullet - enemies
                bullets = bullets.filter(item => item !== undefined); //remove undefined -  out of screen or shot enemy/comet - bullets
                comets = comets.filter(item => item !== undefined); //remove undefined  - out of screen or shot by bullet - comets

            }) //end for bullets.forEachfunc
        } //end bulletMove func

    </script>

</body>
