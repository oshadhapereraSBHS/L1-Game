<!doctype html>
<body>

    <canvas id="gameCanvas" width="600" height="600">

    </canvas>
    <script>
        var canvas, canvasContext;
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
            setInterval(mainloop, 1000 / 60);
            var username = prompt('Enter username')
            var level = prompt('Hello ' + username + '! Choose a level: Easy, Medium or Hard?')
            if(level == 'medium'){
              totalEnemies = 8
            } else if(level == 'hard'){
              totalEnemies = 10;
              highSpeed = 14;
              lowSpeed = 6;
            }
            
            if(level == 'easy'){
                totalBullets = 40
            } else if (level == 'medium'){
                totalBullets = 35
            } else if (level == 'hard'){
                totalBullets = 30
            }
            
            alert('Use arrow keys to move. Avoid and shoot as many red asteroids as you can, and collect as many blue comets as you can. The longer you stay alive, the higher you score will be. You have 3 lives and ' + totalBullets + ' bullets. The game will start as soon as you press OK.')
            
    
        }
        
        
        

        
        var highSpeed = 10;
        var lowSpeed = 6;
        var player = new Image();
        player.src = 'images/player.png'
        var enemyImg = new Image();
        enemyImg.src = 'images/enemy.png'
        const PLAYER_SIZE = 70;
        var playerXpos = 300 - (PLAYER_SIZE / 2);
        var playerYpos = 600 - PLAYER_SIZE;
        var playerXspeed = 5;
        var playerYspeed = 4;
        const ENEMY_WIDTH = 20;
        const ENEMY_HEIGHT = 60;
        var enemyXpos = 0;
        var enemyYpos = 0;
        var enemyXspeed = 5;
        var enemyYspeed = 4;        
        const COMET_WIDTH = 20;
        const COMET_HEIGHT = 60;
        var cometXpos = 0;
        var cometYpos = 0;
        var cometXspeed = 5;
        var cometYspeed = 4;
        var leftKeyPress = false;
        var rightKeyPress = false;
        var upKeyPress = false;
        var downKeyPress = false;
        var spaceKeyPress = false;
        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;
        const SPACE_KEY = 32;
        var hit = false;
        var enemies = [];
        var bullets = [];
        var comets = [];
        var makingEnemies = true;
        var totalEnemies = 5;
        var makingBullets = true;
        var totalBullets = 5;
        var lives = 3;
        var seconds = 0;
        var bulletCount = 0;
var lifeCount = 3

        setInterval(function(){
        if(lives > -1){seconds ++
        }}, 1000)

        
        function makeComet(){
            var cometPos =  Math.floor(Math.random() * 4) + 1;
            var cometXpos = cometPos * (canvas.width / 4)
var cometYpos = 0 - COMET_SIZE
 var cometXspeed = Math.floor(Math.random()*(8-4)+4);
 var cometYspeed = Math.floor(Math.random()*(10-4)+4);
 const COMET_SIZE = 20
 
             var comet = {
                cometXpos: cometXpos,
                cometYpos: cometYpos,
                cometXspeed: cometXspeed,
                cometYspeed: cometYspeed,
                COMET_WIDTH: COMET_WIDTH,
                COMET_HEIGHT: COMET_HEIGHT
            }
             
            comets.push(comet);
        }

            
        function makeEnemies() {
            var enemyPos = Math.floor(Math.random() * 4) + 1;
            var enemyXpos = enemyXpos * (canvas.width / 4);
            const ENEMY_WIDTH = 25;
            const ENEMY_HEIGHT = 65;
            var enemyYpos = 0 - ENEMY_HEIGHT;
            var enemyXspeed = Math.floor(Math.random() * (8 - 4) + 4);
            var enemyYspeed = Math.floor(Math.random() * (highSpeed - lowSpeed) + lowSpeed);
            var enemy = {
                enemyXpos: enemyXpos,
                enemyYpos: enemyYpos,
                enemyXspeed: enemyXspeed,
                enemyYspeed: enemyYspeed,
                ENEMY_WIDTH: ENEMY_WIDTH,
                ENEMY_HEIGHT: ENEMY_HEIGHT
            }
            enemies.push(enemy);
        }
        function makeBullet() {
            const BULLET_SIZE = 5;
            var bulletXpos = playerXpos + (PLAYER_SIZE / 2) - BULLET_SIZE / 2;
            var bulletYpos = playerYpos;
            var bulletYspeed = 20;
            var bullet = {
                bulletXpos: bulletXpos,
                bulletYpos: bulletYpos,
                bulletYspeed: bulletYspeed,
                BULLET_SIZE: BULLET_SIZE
                
            }
            
            bullets.push(bullet);
        }
        function drawBullet() {
            bullets.forEach(function(bullet, i) {
                colorRect(bullet.bulletXpos, bullet.bulletYpos, bullet.BULLET_SIZE, bullet.BULLET_SIZE, 'white');
               
            })
        }
        
        



        function mainloop() {
          document.getElementById('scoreCount').innerHTML = 'Score: ' + seconds
          document.getElementById('lifeCount').innerHTML = 'Lives: ' + lives

                  if (lifeCount == 0){
                    alert('Game over. Your score is ' + seconds)
                  lifeCount = -1
alert('Play again?')
                    location.reload();
    
                      
                  };


            colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
            drawImg(player, playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE); // player
            colorRect(cometXpos, cometYpos, COMET_WIDTH, COMET_HEIGHT, 'blue') // comet
        
            playerMove();
            enemyMove();
            console.log(lives)
            if (makingEnemies == true) {
                for (i = 0; i < totalEnemies; i++) {
                    makeEnemies();
                }
                makingEnemies = false;
            }
            drawEnemy();
            
            
            
            if(bulletCount <= totalBullets){
            bulletMove();
            if(makingBullets == true) {
                for (i=0; i < totalBullets; i++){
                    makeBullet();
                }
                makingBullets = false;
               
              }
              drawBullet();
             
        }
        
        cometMove()
        
        
            
            
            
        
        }
        function drawEnemy() {
            enemies.forEach(function(enemy, i) {
                drawImg(enemyImg, enemy.enemyXpos, enemy.enemyYpos, enemy.ENEMY_WIDTH, enemy.ENEMY_HEIGHT)
            })
        }
        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }
        
        
        
        
        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        }
        function keyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPress = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPress = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPress = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPress = true;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPress = true;
                makeBullet();
                bulletCount++
            }
        }
        function keyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPress = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPress = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPress = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPress = false;
            }
        }
        
        
        function cometMove(){
            cometXpos +=cometXspeed;
            cometYpos += cometYspeed
            if(cometXpos + COMET_WIDTH > canvas.width){ // right edge bouce
               cometXspeed = cometXspeed * -1;
            }
            if(cometXpos < 0){ // left edge bouce
               cometXspeed = cometXspeed * -1;
            }
            
            if(cometYpos > canvas.height){
                cometYpos = 0 - COMET_HEIGHT;
                cometXpos = Math.floor(Math.random()*(canvas.width - COMET_WIDTH))
                cometYspeed = Math.floor(Math.random()*(10-4)+4)
            }
            
            
            if(playerYpos <= cometYpos + COMET_HEIGHT && playerYpos + PLAYER_SIZE >= cometYpos && playerXpos <= cometXpos + COMET_WIDTH && playerXpos + PLAYER_SIZE >= cometXpos){
                
                cometYpos = 0 - COMET_HEIGHT;
                cometXpos = Math.floor(Math.random() * (canvas.width - COMET_WIDTH));
                cometYspeed = Math.floor(Math.random() * (10-4) + 4);   
                }
            
        }
        
        function playerMove() {
            if (leftKeyPress == true && playerXpos > 0) {
                playerXpos -= playerXspeed;
            };
            if (rightKeyPress == true && playerXpos < canvas.width - PLAYER_SIZE) {
                playerXpos += playerXspeed;
            };
            if (upKeyPress == true && playerYpos > 0) {
                playerYpos -= playerYspeed;
            };
            if (downKeyPress == true && playerYpos < canvas.height - PLAYER_SIZE) {
                playerYpos += playerYspeed;
            };
          }
        
        
        
        
        
        
        function enemyMove() {
            enemies.forEach(function(enemy,i,array) {
                enemy.enemyYpos += enemy.enemyYspeed;
                if (enemy.enemyYpos > canvas.height) {
                    enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                    enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                    enemy.enemyYspeed = Math.floor(Math.random() * (highSpeed - lowSpeed) + lowSpeed);
                }
            if(playerYpos <= enemy.enemyYpos + enemy.ENEMY_HEIGHT && playerYpos + PLAYER_SIZE >= enemy.enemyYpos && playerXpos <= enemy.enemyXpos + enemy.ENEMY_WIDTH && playerXpos + PLAYER_SIZE >= enemy.enemyXpos) { 
                              enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                              enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                              enemy.enemyYspeed = Math.floor(Math.random() * (highSpeed - lowSpeed) + lowSpeed);

                                if(lives > 0){
                              lives --
                                    lifeCount--
                                    seconds = seconds - 4
                                
                                }
                            }
            })
        }

        
        
        
        function bulletMove() {
            bullets.forEach(function(bullet,i,array) {
                        bullet.bulletYpos -= bullet.bulletYspeed

                
                
                        if (bullet.bulletYpos < 0) {
                            delete bullets[i]
                        }
                
                
                
                        enemies.forEach(function(enemy,i,array){    
                            
                          if(bullet.bulletYpos < enemy.enemyYpos + enemy.ENEMY_HEIGHT && bullet.bulletYpos + bullet.BULLET_SIZE < enemy.enemyYpos && bullet.bulletXpos < enemy.enemyXpos + enemy.ENEMY_WIDTH && bullet.bulletXpos + bullet.BULLET_SIZE > enemy.enemyXpos){
                            enemy.enemyYpos = 0 - enemy.ENEMY_HEIGHT;
                            enemy.enemyXpos = Math.floor(Math.random() * (canvas.width - enemy.ENEMY_WIDTH));
                            enemy.enemyYspeed = Math.floor(Math.random() * (highSpeed - lowSpeed) + lowSpeed);
                            delete bullets[i];
                              seconds = seconds + 3
                            }
                        })
                        enemies = enemies.filter(item => item !== undefined);
                
                        bullets = bullets.filter(item => item !== undefined);
                }
            )
        }
    </script>
<p id="scoreCount">
Score:
</p>
<p id="lifeCount">
Lives:
</p>
</body>